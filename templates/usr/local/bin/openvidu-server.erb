#!/bin/sh
SERVICE_NAME=openviduserver
PATH_TO_JAR=<%= @install_path %>/openvidu-server-<%= @openvidu_version %>.jar
PID_PATH_NAME=/tmp/openviduserver-pid
OPCOES="-Dopenvidu.secret=<%= @secret %> \
	-Dopenvidu.publicurl=https://<%= @public_url %>:<%= @public_port %>/ \
	-Dopenvidu.recording=<%= @recording %> \
	-Dopenvidu.recording.path=<%= @recording_path %> \
	-Dkms.uris=<%= @kms_uris %> \
	-Dopenvidu.recording.autostop-timeout=<%= @recording_autostop %>"
case $1 in
start)
       echo "Starting $SERVICE_NAME ..."
  if [ ! -f $PID_PATH_NAME ]; then
       cd <%= @install_path %>
       #nohup java -jar ${OPCOES} $PATH_TO_JAR /tmp 2>> <%= @logfile %>  >><%= @logfile %> &
       nohup java -jar ${OPCOES} $PATH_TO_JAR >> <%= @logfile %> 2>> <%= @logfile %> &
       exit
                   echo $! > $PID_PATH_NAME
       echo "$SERVICE_NAME started ..."
  else
       echo "$SERVICE_NAME is already running ..."
  fi
  :
;;
stop)
  if [ -f $PID_PATH_NAME ]; then
         PID=$(cat $PID_PATH_NAME);
         echo "$SERVICE_NAME stoping ..."
         kill $PID;
         echo "$SERVICE_NAME stopped ..."
         rm $PID_PATH_NAME
  else
         echo "$SERVICE_NAME is not running ..."
  fi
;;
restart)
  if [ -f $PID_PATH_NAME ]; then
      PID=$(cat $PID_PATH_NAME);
      echo "$SERVICE_NAME stopping ...";
      kill $PID;
      echo "$SERVICE_NAME stopped ...";
      rm $PID_PATH_NAME
      echo "$SERVICE_NAME starting ..."
      nohup java -jar $PATH_TO_JAR /tmp >> <%= @logfile %> 2>> <%= @logfile %> &
      echo $! > $PID_PATH_NAME
      echo "$SERVICE_NAME started ..."
  else
      echo "$SERVICE_NAME is not running ..."
     fi     ;;
 esac
